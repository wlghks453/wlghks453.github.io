---
layout: default
title: 카프카 기본개념
parent: 카프카
nav_order: 1
---

## 목차
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# 카프카 기본개념

## **카프카 브로커**
- 하나의 **서버**에는 하나의 **카프카 브로커**가 실행됩니다.
- 데이터를 **안전하게 보관하고 처리**하기 위해 **3대 이상의 브로커**를 하나의 **클러스터**로 묶어 운영합니다.

## 토픽
- 토픽은 카프카에서 데이터를 구분하기 위해 사용하는 단위입니다.
- 토픽은 1개 이상의 파티션을 소유하고 있습니다.
- 파티션에는 프로듀서가 보낸 데이터들이 들어가 저장되는데 이 데이터를 레코드라고 한다.

## **리더 파티션**
- **프로듀서와 컨슈머**가 연결되어 **쓰기와 읽기 작업**을 수행하는 주요 파티션입니다.
- 대부분의 스토리지는 **복제본을 통해 읽기와 쓰기 트래픽을 분산**하지만, 카프카는 **리더 파티션만 사용**하여 트래픽을 처리하는 것이 특징입니다.

{: .note }
> 리더 파티션에 장애가 발생하면, 컨트롤러가 **팔로우 파티션 중 새로운 리더**를 선출합니다.
>
> **리더 선출 중**에는 일시적으로 **읽기와 쓰기 작업이 멈출 수 있습니다**.


## **팔로우 파티션**
- **장애 상황**에 대비한 **예비 파티션**으로, 프로듀서와 컨슈머가 연결되어 있지 않습니다.
- **리더 파티션과 동기화**를 유지하며, 장애 발생 시 **새로운 리더로 승격**됩니다.

## **ISR(In-Sync Replica)**
- **동기화 중인 파티션들**을 의미하며, 이 중에서 **리더 파티션으로 승격**될 수 있습니다.

## **컨트롤러 역할**
- 클러스터의 브로커 중 하나가 **컨트롤러** 역할을 수행합니다.
- **컨트롤러**는 브로커의 상태를 점검하고, **리더 파티션을 위임**합니다.

{: .note }
> 컨트롤러 장애 시, 다른 브로커가 **컨트롤러 역할**을 대신합니다.

## **데이터 삭제**
- 데이터는 **파일 단위로 삭제**되며, 이 단위를 **로그 세그먼트(Log Segment)** 라고 부릅니다.
- **세그먼트 파일**은 **데이터가 쌓이는 동안 파일 시스템에서 열려 있으며**, **크기(기본값: 1GB)** 또는 **시간 기준**에 따라 닫힙니다.
- **세그먼트 크기를 작게 설정**하면 파일을 자주 열고 닫아야 하므로 **시스템 부하**가 발생할 수 있습니다.
- **닫힌 세그먼트 파일**은 **옵션에 따라 삭제되거나 압축**될 수 있습니다.

## **코디네이터**
- 클러스터의 한 브로커는 **코디네이터** 역할을 담당하며, **컨슈머 그룹의 상태**를 관리합니다.
- **코디네이터**는 파티션을 컨슈머와 매칭하고, 컨슈머가 **추가되거나 제거될 때 리밸런싱**을 수행합니다.

{: .warning }
> **리밸런싱** 이 발생하는 경우
> 
> **컨슈머가 추가**되어 새로운 파티션을 할당해야 할 때.
> 
> **컨슈머 장애**로 인한 재할당이 필요할 때.
> 
> 리밸런스가 진행되는 동안 **컨슈머는 데이터를 읽지 못합니다**.