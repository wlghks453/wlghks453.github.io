---
layout: default
title: 프로듀서
parent: 카프카
nav_order: 2
---

# 페이지 제목을 입력하세요. <!-- {: .no_toc } 목차를 만들지 않습니다. 즉 제목을 목차로 만들지 않는다. -->
{: .no_toc }

## 목차설명을 여기에다가 하면 될 것 같아요.
{: .no_toc .text-delta }

1. TOC <!-- 1. TOC와 {:toc}는 함께 사용해야 제대로 작동합니다. {:toc} 마커는 실제로 목차를 삽입하는 위치를 지정하는 것이며, 1. TOC는 목록 항목을 만들고 목차가 삽입될 자리를 확보합니다. Heading을 통해서 목차가 자동으로 생성됩니다. -->
   {:toc}

---

# **카프카 프로듀서**
- **프로듀서(Producer)** 는 카프카에 데이터를 보내는 역할을 담당합니다.
- 데이터를 **토픽의 파티션**에 전송하며, **데이터의 일관성, 순서, 전송 성공 여부**를 관리합니다.

## **파티셔너 - 라운드로빈과 유니폼 스티키**

### **라운드로빈 파티셔너**
- 메시지를 **하나하나 파티션에 순차적으로 분배**합니다.
- 이 방식은 데이터가 균등하게 분산되지만, 개별 메시지 전송이기 때문에 **비효율적인 경우**가 있습니다.

### **유니폼 스티키 파티셔너**
- **여러 메시지를 배치로 묶어** 한 번에 전송합니다.
- 라운드로빈 방식의 **단점을 개선**하여 성능을 높이고, 데이터 일관성을 보장합니다.

## **프로듀서 옵션**

### **acks 옵션**
- 프로듀서가 **전송한 데이터가 정상적으로 저장되었는지** 확인하는 설정입니다.
- **0, 1, -1(all)** 중 하나를 선택할 수 있습니다.

1. **acks=0**:
   - **브로커의 응답과 상관없이** 데이터를 전송한 즉시 성공으로 간주합니다.
   - 데이터 유실 위험이 있지만, **빠른 전송 속도**를 제공합니다.

2. **acks=1** (기본값):
   - **리더 파티션에 데이터가 저장**되면 성공으로 판단합니다.
   - 비교적 안전하면서도 **성능이 뛰어난 설정**입니다.

3. **acks=-1 (all)**:
   - 데이터가 **리더와 ISR(In-Sync Replica) 파티션에 모두 저장**되어야 성공으로 간주합니다.
   - **높은 데이터 신뢰성**을 보장하지만 성능이 저하될 수 있습니다.

### **min.insync.replicas 옵션**
- **ISR에 포함된 최소 파티션 수**를 정의합니다.
- 예: 브로커가 3대이고 `min.insync.replicas=3`인 경우, 한 대라도 장애가 발생하면 프로듀서가 데이터를 전송할 수 없습니다.
- **추천 설정**: 브로커 수보다 **작게 설정**하여 장애 상황에서도 데이터 전송이 가능하도록 합니다.

## **데이터 순서 유지**

### **동기 전송 권장**
- **동기 전송**을 사용하면 메시지 순서를 보장할 수 있습니다.
- 비동기 전송 시, 메시지 1번 전송이 실패하고 2번 메시지가 성공한 후, 1번 메시지가 재시도되어 **순서가 역전**될 수 있습니다.

```text
예:  
1번 메시지 → 실패  
2번 메시지 → 성공  
1번 메시지 → 재시도 성공  
결과: 메시지 순서 역전 (2번 → 1번)
```
- **동기 전송**을 사용하면 **전송 결과를 기다리며 순서를 보장**합니다.

## **파티션 수와 순서 보장**

- **파티션이 여러 개일 경우**, 순서를 보장하기 어렵습니다.
   - 예: 3번 파티션 → 1번 파티션 → 2번 파티션 순서로 처리될 수 있음.
- **순서를 보장하고 싶다면**:
   - **파티션을 1개로 설정**합니다.
   - 또는 **특정 키**를 설정해, 해당 키를 가진 데이터가 **같은 파티션**에 들어가도록 합니다. 