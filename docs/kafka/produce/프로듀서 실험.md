---
layout: default
title: í”„ë¡œë“€ì„œ ì‹¤í—˜
grand_parent: ì¹´í”„ì¹´
parent: í”„ë¡œë“€ì„œ
nav_order: 1
---

## ëª©ì°¨
{: .no_toc .text-delta }

1. TOC
{:toc}

---
# Kafka í”„ë¡œë“€ì„œ ì˜µì…˜ ì‹¤í—˜

Kafka í”„ë¡œë“€ì„œì˜ ì£¼ìš” ì˜µì…˜ë“¤ì„ ì •ë¦¬í•˜ê³ ,  
ê° ì˜µì…˜ì´ ë©”ì‹œì§€ ì „ì†¡ ë°©ì‹ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ëŠ”ì§€ ì‹¤í—˜ì„ í†µí•´ í™•ì¸í•œë‹¤.

# í”„ë¡œë“€ì„œ ì˜µì…˜

Kafka í”„ë¡œë“€ì„œì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” ì˜µì…˜ë“¤ì„ ì •ë¦¬í•œë‹¤.

| ì˜µì…˜ëª… | ì„¤ëª… | ê¸°ë³¸ê°’ |
|--------|------|--------|
| `acks` | ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ í›„, ë¸Œë¡œì»¤ë¡œë¶€í„° ì–´ë–¤ ìˆ˜ì¤€ì˜ ì‘ë‹µì„ ë°›ì„ì§€ ì„¤ì •í•œë‹¤. `0`, `1`, `all` ê°’ ì‚¬ìš© ê°€ëŠ¥. | `1` |
| `retries` | ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜ | `2147483647` |
| `batch.size` | í•˜ë‚˜ì˜ ë°°ì¹˜ì— ë‹´ê¸¸ ìˆ˜ ìˆëŠ” ìµœëŒ€ ë°”ì´íŠ¸ ìˆ˜ | `16384` (16KB) |
| `linger.ms` | ë°°ì¹˜ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„(ms). ì´ ì‹œê°„ ì•ˆì— batchê°€ ê½‰ ì°¨ì§€ ì•Šì•„ë„ ì „ì†¡í•¨ | `0` |
| `compression.type` | ì „ì†¡ ì‹œ ì‚¬ìš©í•  ì••ì¶• ë°©ì‹. `none`, `gzip`, `snappy`, `lz4`, `zstd` ì¤‘ ì„ íƒ | `none` |
| `enable.idempotence` | ë©”ì‹œì§€ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ì˜µì…˜. ì •í™•íˆ í•œ ë²ˆë§Œ ì „ì†¡ì„ ë³´ì¥ | `false` |
| `max.in.flight.requests.per.connection` | í•˜ë‚˜ì˜ ì»¤ë„¥ì…˜ì—ì„œ ë™ì‹œì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ìš”ì²­ ìˆ˜ | `5` |
| `buffer.memory` | í”„ë¡œë“€ì„œê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ì´ëŸ‰ (ë°”ì´íŠ¸) | `33554432` (32MB) |

---

## ì‹¤í—˜ í™˜ê²½

- Kafka ë¸Œë¡œì»¤ëŠ” ì´ 3ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ì˜€ë‹¤.
- ê° ë¸Œë¡œì»¤ëŠ” ë™ì¼í•œ ì„¤ì •ìœ¼ë¡œ Docker Composeë¥¼ ì´ìš©í•´ ì‹¤í–‰ë˜ë©°, ê¸°ë³¸ì ì¸ Replicationê³¼ Partition ì„¤ì •ì€ Kafkaì˜ ê¸°ë³¸ê°’ì„ ë”°ë¥¸ë‹¤.
- 
- ê´€ì°°ì„ ìœ„í•´ [Redpanda Console](https://redpanda.com/console/)ì„ ì‚¬ìš©í–ˆë‹¤.

## ê¸°ë³¸ ì‹¤í—˜

Kafka í”„ë¡œë“€ì„œì˜ ê¸°ë³¸ ì„¤ì • ìƒíƒœì—ì„œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í–ˆì„ ë•Œ  
ë©”ì‹œì§€ë“¤ì´ íŒŒí‹°ì…˜ì— ì–´ë–»ê²Œ ë¶„ë°°ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

### í…ŒìŠ¤íŠ¸ ì½”ë“œ
```java
@Configuration
public class KafkaProducerConfig {
    private final String BOOTSTRAP_SERVER = "localhost:9092,localhost:9093,localhost:9094";

    @Bean
    public ProducerFactory<String, String> producerFactory() {
        Map<String, Object> config = new HashMap<>();
        config.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVER);
        config.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        config.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        return new DefaultKafkaProducerFactory<>(config);
    }
}
```

```java
private final String TOPIC_NAME = "my.test.topic";

@Test
void í† í”½ë©”ì‹œì§€500ë²ˆë„£ê¸°() {
    long start = System.currentTimeMillis();
    for (int i = 1; i <= 500; i++) {
        kafkaTemplate.send(TOPIC_NAME, "data insert - " + i);
    }
    long end = System.currentTimeMillis();
    System.out.println("ì´ ì†Œìš” ì‹œê°„: " + (end - start) + "ms");
}
```

### ê²°ê³¼
![ê¸°ë³¸ì‹¤í—˜.png](ê¸°ë³¸ì‹¤í—˜.png)
- ì´ ì†Œìš” ì‹œê°„: 139ms

3ë²ˆ íŒŒí‹°ì…˜ì— 100ê°œ (ì²˜ìŒì— 100ê°œë¡œ ì‚¬ì „ í…ŒìŠ¤íŠ¸)  
0ë²ˆ íŒŒí‹°ì…˜ì— 500ê°œì˜ ë©”ì‹œì§€ê°€ ë“¤ì–´ê°„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ë©”ì‹œì§€ë“¤ì´ íŠ¹ì • íŒŒí‹°ì…˜ìœ¼ë¡œë§Œ ì „ì†¡ë˜ëŠ” ì´ìœ ëŠ”  
Kafka í”„ë¡œë“€ì„œê°€ ê¸°ë³¸ì ìœ¼ë¡œ **`sticky partitioner`** ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

- ë©”ì‹œì§€ë¥¼ ë°°ì¹˜ë¡œ ì „ì†¡í•  ë•Œ í•˜ë‚˜ì˜ íŒŒí‹°ì…˜ì„ ì„ íƒí•˜ê³ ,  
  í•´ë‹¹ ë°°ì¹˜ê°€ ì „ì†¡ë˜ê¸° ì „ê¹Œì§€ëŠ” ê³„ì† ê·¸ íŒŒí‹°ì…˜ìœ¼ë¡œë§Œ ë³´ë‚¸ë‹¤.
- ì´í›„ ë°°ì¹˜ê°€ ì „ì†¡ë˜ê³  ë‚˜ë©´, ë‹¤ìŒ ë°°ì¹˜ë¶€í„°ëŠ” ë‹¤ë¥¸ íŒŒí‹°ì…˜ìœ¼ë¡œ ë³€ê²½ë  ìˆ˜ ìˆë‹¤.

---

## ğŸ“¦ batch.sizeì™€ linger.ms ì‹¤í—˜

### ì†ŒìŠ¤ì½”ë“œ

```java
@Bean
public ProducerFactory<String, String> producerFactory() {
    Map<String, Object> config = new HashMap<>();
    config.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVER);
    config.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
    config.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
    config.put(ProducerConfig.BATCH_SIZE_CONFIG, 1);
    config.put(ProducerConfig.LINGER_MS_CONFIG, 0);
    return new DefaultKafkaProducerFactory<>(config);
}
```

- `BATCH_SIZE_CONFIG`, `LINGER_MS_CONFIG` ì˜µì…˜ì„ ìµœì†Œê°’ìœ¼ë¡œ ì„¤ì •í•˜ì˜€ë‹¤.
- ì‚¬ì‹¤ìƒ ë°°ì¹˜ ê¸°ëŠ¥ì„ ê»ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

### ê²°ê³¼

![ë°°ì¹˜êº¼ë²„ë¦¬ê¸°.png](ë°°ì¹˜êº¼ë²„ë¦¬ê¸°.png)

- ì´ ì†Œìš” ì‹œê°„: `123ms`
- ê·¸ëŸ°ë°... ì „ì†¡ ì‹œê°„ì€ ì´ì „ê³¼ í¬ê²Œ ì°¨ì´ ë‚˜ì§€ ì•Šì•˜ë‹¤.

500ê°œì˜ ë©”ì‹œì§€ë“¤ì´ 6ê°œì˜ íŒŒí‹°ì…˜ì— ê³ ë¥´ê²Œ ë¶„ì‚°ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ë¶„ì„

batch.sizeì™€ linger.msë¥¼ ìµœì†Œë¡œ ì„¤ì •í•˜ë©´,  
ë©”ì‹œì§€ë“¤ì´ ê±°ì˜ ê°œë³„ì ìœ¼ë¡œ ì „ì†¡ë˜ê¸° ë•Œë¬¸ì— sticky partitioner ì˜ë¯¸ê°€ ì‚¬ë¼ì§„ë‹¤.

ê·¸ë˜ì„œ ë¼ìš´ë“œë¡œë¹ˆì²˜ëŸ¼ ì—¬ëŸ¬ íŒŒí‹°ì…˜ìœ¼ë¡œ ë¶„ì‚°ë˜ëŠ” íŒ¨í„´ì„ ë³´ì¸ ë“¯í•˜ë‹¤.

ì „ì†¡ì†ë„ ë¶€ë¶„ì—ì„œëŠ”, ì „ì†¡ì€ ì†Œì¼“ì„ ë§¤ë²ˆ ìƒˆë¡œ ì—¬ëŠ” ê²Œ ì•„ë‹ˆê³   
í•œë²ˆ ì—´ë¦° í›„ ê³„ì† ì¬ì‚¬ìš©í•˜ëŠ” ë“¯ì´ ë³´ì¸ë‹¤.

---

## ğŸŒ»enable.idempotence ì‹¤í—˜

Kafka í”„ë¡œë“€ì„œì˜ enable.idempotence ì˜µì…˜ì€
ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ë¸Œë¡œì»¤ ì¥ì•  ë“±ìœ¼ë¡œ ì¸í•´ ì¬ì‹œë„ê°€ ë°œìƒí–ˆì„ ë•Œ,
ì¤‘ë³µëœ ë©”ì‹œì§€ê°€ Kafkaì— ê¸°ë¡ë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë‹¤.
ì¦‰, ì •ìƒì ì¸ ìƒí™©ì—ì„œëŠ” ì•„ë¬´ëŸ° íš¨ê³¼ê°€ ì—†ìœ¼ë©°,
ì˜ˆì™¸ ìƒí™©ì—ì„œ "ì •í™•íˆ í•œ ë²ˆ ì „ì†¡"ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ì˜µì…˜ì´ë‹¤.

| ì˜µì…˜ê°’ | ì„¤ëª… |
|--------|------|
| `false` (ê¸°ë³¸ê°’) | ì „ì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„í•˜ë©´ ì¤‘ë³µ ë©”ì‹œì§€ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤. |
| `true` | Kafkaê°€ ì „ì†¡ ìˆœì„œì™€ ì¤‘ë³µ ë°©ì§€ë¥¼ ê´€ë¦¬í•œë‹¤. ì •í™•íˆ í•œ ë²ˆ ì „ì†¡ë¨. |

---

### ì‹¤í—˜ ì‹œë‚˜ë¦¬ì˜¤

- Kafka í´ëŸ¬ìŠ¤í„° (3ëŒ€)ë¥¼ êµ¬ì„±í•œ ìƒíƒœì—ì„œ
- ë¸Œë¡œì»¤ë¥¼ ê³„ì† ì£½ì˜€ë‹¤ ì‚´ë ¸ë‹¤ ë°˜ë³µí•˜ë©° ë„¤íŠ¸ì›Œí¬ ì¥ì•  ìƒí™©ì„ í‰ë‚´ëƒ„
- í”„ë¡œë“€ì„œëŠ” `enable.idempotence` ê°’ì„ true / false ë¡œ ê°ê° ì„¤ì •í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ì „ì†¡
- ì»¨ìŠˆë¨¸ ì¸¡ì—ì„œ ìˆ˜ì‹ ëœ ë©”ì‹œì§€ë¥¼ ì¤‘ë³µ ì—¬ë¶€ë¡œ ë¶„ì„

---

### Kafka ë¸Œë¡œì»¤ í•™ëŒ€ ìë™í™” ë£¨í”„ ë°°ì¹˜íŒŒì¼

```
@echo off
:loop

echo Restarting kafka1...
docker stop kafka1
timeout /t 3 > nul
docker start kafka1
timeout /t 3 > nul

echo Restarting kafka2...
docker stop kafka2
timeout /t 3 > nul
docker start kafka2
timeout /t 3 > nul

echo Restarting kafka3...
docker stop kafka3
timeout /t 3 > nul
docker start kafka3
timeout /t 3 > nul

echo === One cycle done! ===
timeout /t 5 > nul
goto loop
```

---

### í”„ë¡œë“€ì„œ ì„¤ì •

```
@Bean
public ProducerFactory<String, String> producerFactory() {
    Map<String, Object> config = new HashMap<>();
    config.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVER);
    config.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
    config.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
    config.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, false); // trueë¡œë„ í…ŒìŠ¤íŠ¸í•  ê²ƒ
    return new DefaultKafkaProducerFactory<>(config);
}
```

---

### ë©”ì‹œì§€ ì „ì†¡ ì½”ë“œ

```
@Test
void í† í”½ë©”ì‹œì§€10000ë²ˆë„£ê¸°() throws InterruptedException {
    long start = System.currentTimeMillis();
    for (int i = 1; i <= 10000; i++) {
        String s = UUID.randomUUID().toString();
        kafkaTemplate.send(TOPIC_NAME, "data insert - " + s + " : " + i);
        System.out.println("ë³´ë‚´ëŠ” ì¤‘ " + i);
        Thread.sleep(1); // ì „ì†¡ ê°„ í…€
    }
    long end = System.currentTimeMillis();
    System.out.println("ì´ ì†Œìš” ì‹œê°„: " + (end - start) + "ms");
}
```

---

### ê²°ê³¼

- `enable.idempotence = false`ì¸ ê²½ìš°, ì¤‘ë³µ ë©”ì‹œì§€ê°€ ê°„í—ì ìœ¼ë¡œ ë°œìƒí–ˆë‹¤.  
  ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ìˆ˜ì‹  ê°œìˆ˜ê°€ 10006ê°œ, 10004ê°œ ë“±ìœ¼ë¡œ ë‹¬ë¼ì¡Œë‹¤.
- `enable.idempotence = true`ì¸ ê²½ìš°, ì¤‘ë³µ ì—†ì´ ì •í™•íˆ 10000ê°œì˜ ë©”ì‹œì§€ê°€ ìˆ˜ì‹ ë˜ì—ˆë‹¤.  
  ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•´ë„ ê²°ê³¼ëŠ” ë™ì¼í–ˆê³ , ì¤‘ë³µ ë©”ì‹œì§€ëŠ” ê²€ì¶œë˜ì§€ ì•Šì•˜ë‹¤.

