---
layout: default
title: 스프링 트랜잭션 옵션
parent: SPRING DB
grand_parent: 스프링
nav_order: 7
---

## 목차
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# 📄 트랜잭션 옵션 소개

스프링 트랜잭션은 다양한 옵션을 제공하여 세부적으로 트랜잭션의 동작을 제어할 수 있습니다. 

## 주요 트랜잭션 옵션

### 1. `value`, `transactionManager`
어떤 트랜잭션 매니저를 사용할지 지정하는 옵션입니다. 보통 기본 트랜잭션 매니저를 사용하지만, 여러 트랜잭션 매니저가 있을 때는 이 옵션을 통해 명시적으로 지정할 수 있습니다.

### 2. `rollbackFor`, `noRollbackFor`
기본적으로 **언체크 예외**(`RuntimeException`, `Error`)가 발생하면 롤백이 되지만, **체크 예외**(`Exception`)는 커밋됩니다. 이 옵션을 사용하면 특정 예외 발생 시 롤백 또는 롤백 제외를 명시할 수 있습니다.

### 3. `propagation`
트랜잭션 전파 방식을 지정하는 옵션으로, 트랜잭션 간의 관계를 정의합니다.

### 4. `isolation`
트랜잭션 격리 수준을 설정하는 옵션입니다. 기본적으로 데이터베이스의 설정을 따르며, 동시성 제어를 위한 트랜잭션 격리 수준을 명시할 수 있습니다.

### 5. `timeout`
트랜잭션의 최대 수행 시간을 초 단위로 설정할 수 있습니다. 이 시간이 초과되면 트랜잭션이 롤백됩니다.

### 6. `readOnly`
**readOnly** 옵션은 **읽기 전용 트랜잭션**을 생성합니다. 이 경우 **등록**, **수정**, **삭제**가 금지되며, **읽기 작업**만 가능합니다. **readOnly=true**로 설정하면, 성능 최적화를 기대할 수 있습니다.

#### 적용 범위
- **프레임워크**: 예를 들어, **JPA**에서는 읽기 전용 트랜잭션일 경우 **flush**를 호출하지 않으며, 변경 감지를 위한 스냅샷도 생성하지 않습니다. 이를 통해 성능 최적화가 이루어집니다.
- **JDBC 드라이버**: 드라이버가 읽기 전용 트랜잭션에서 **변경 쿼리**를 실행하면 예외를 던집니다. 또한 **읽기 전용 데이터베이스**(슬레이브)와 **쓰기 데이터베이스**(마스터)를 구분해 요청할 수 있습니다.
- **데이터베이스**: 데이터베이스 자체에서도 읽기 전용 트랜잭션을 성능 최적화할 수 있습니다.

---

# 📄 예외와 트랜잭션 커밋, 롤백 - 활용

스프링 트랜잭션은 **체크 예외**와 **언체크 예외(런타임 예외)** 에 따라 **커밋**과 **롤백** 동작을 다르게 처리합니다. 기본적으로 **언체크 예외**는 롤백, **체크 예외**는 커밋됩니다.

## 1. 왜 언체크 예외는 롤백하고, 체크 예외는 커밋할까?

- **체크 예외**: 비즈니스 의미가 있는 경우에 사용됩니다. 시스템에는 문제가 없지만, 특정 비즈니스 상황에 의해 발생하는 예외로, 이를 처리해 **커밋**할 수 있습니다.
- **언체크 예외(런타임 예외)**: 복구 불가능한 예외로 가정됩니다. 시스템적인 문제가 발생했으므로 **롤백**을 통해 데이터 무결성을 보장합니다.

### 비즈니스 예외와 예시

비즈니스 상황에서 발생할 수 있는 **비즈니스 예외**는 시스템적인 오류가 아닌 **비즈니스 로직**에서 처리해야 하는 경우입니다. 예를 들어, 결제 시 **잔고 부족**과 같은 상황이 이에 해당합니다. 이런 경우 **주문 데이터를 저장**하고, 결제 상태를 **대기**로 처리하는 등, 체크 예외로서 **커밋**할 수 있습니다.

## 2. 정책 변경 가능성

물론, 이 기본 정책을 따를 필요는 없으며, `rollbackFor` 옵션을 사용하여 **체크 예외**도 **롤백**할 수 있습니다. 상황에 맞게 트랜잭션 동작을 커스터마이즈할 수 있습니다.

```java
@Transactional(rollbackFor = Exception.class)
```

이렇게 필요에 따라 **체크 예외**도 **롤백**이 가능하도록 설정할 수 있습니다.

---