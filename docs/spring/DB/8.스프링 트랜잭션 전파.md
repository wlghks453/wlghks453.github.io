---
layout: default
title: 스프링 트랜잭션 전파
parent: SPRING DB
grand_parent: 스프링
nav_order: 8
---

## 목차
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# 🚫 스프링 트랜잭션 전파 - 기본 개념

스프링에서 **트랜잭션 전파(propagation)** 는 **하나의 트랜잭션이 이미 진행 중일 때**, 추가로 트랜잭션을 수행하는 경우 어떻게 동작할지 결정하는 방식입니다. 예를 들어, **외부 트랜잭션**이 이미 시작된 상황에서 **내부 트랜잭션**이 호출된다면, 이 두 트랜잭션을 어떻게 처리할지 결정하는 것이 바로 트랜잭션 전파입니다.

스프링은 다양한 트랜잭션 전파 옵션을 제공하며, 여기서는 기본 전파 옵션인 **`REQUIRED`**를 중심으로 설명하겠습니다.

## 1. 트랜잭션 전파의 기본 동작 - `REQUIRED`

기본적으로 스프링은 **외부 트랜잭션과 내부 트랜잭션을 하나의 트랜잭션으로 묶어 처리**합니다. 즉, **내부 트랜잭션이 외부 트랜잭션에 참여**하게 됩니다. 이 방식이 바로 스프링에서 기본적으로 사용하는 **`REQUIRED`** 전파 방식입니다.

- **외부 트랜잭션**: 가장 처음 시작된 트랜잭션으로, 상대적으로 외부에서 시작된 트랜잭션입니다.
- **내부 트랜잭션**: 외부 트랜잭션이 진행되는 중간에 호출된 트랜잭션입니다.

스프링은 **외부 트랜잭션과 내부 트랜잭션을 하나의 트랜잭션**으로 묶어서 관리합니다. 따라서, **내부 트랜잭션은 외부 트랜잭션에 참여**하여 함께 커밋되거나 롤백됩니다.

## 2. 물리 트랜잭션과 논리 트랜잭션

스프링은 트랜잭션 전파를 설명할 때 **물리 트랜잭션**과 **논리 트랜잭션** 개념을 사용합니다.

- **물리 트랜잭션**: 실제 데이터베이스에서 **커밋** 또는 **롤백**이 발생하는 **하나의 트랜잭션**입니다. 데이터베이스 커넥션을 통해 **트랜잭션을 시작(setAutoCommit(false))** 하고, 최종적으로 **커밋**이나 **롤백**을 통해 종료됩니다.
- **논리 트랜잭션**: **트랜잭션 매니저**를 통해 트랜잭션이 적용된 단위입니다. 하나의 **물리 트랜잭션**에 여러 개의 **논리 트랜잭션**이 포함될 수 있습니다.

### 예시 상황

- 외부 트랜잭션이 진행되는 동안, **내부에서 또 다른 트랜잭션**이 호출될 수 있습니다. 이 경우, 두 트랜잭션은 하나의 물리 트랜잭션으로 묶입니다.
- **모든 논리 트랜잭션**이 커밋되어야 **물리 트랜잭션**이 최종적으로 **커밋**됩니다.
- 만약 **하나라도 논리 트랜잭션이 롤백**되면, 전체 **물리 트랜잭션**이 롤백됩니다.

## 3. 논리 트랜잭션의 커밋과 롤백 원칙

스프링의 트랜잭션 전파에서 기억해야 할 중요한 원칙은 다음과 같습니다:

- **모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋된다.**
- **하나의 논리 트랜잭션이라도 롤백되면, 전체 물리 트랜잭션이 롤백된다.**

예시

- **논리 트랜잭션 모두 커밋**: 외부와 내부의 모든 논리 트랜잭션이 성공적으로 커밋되면, 전체 물리 트랜잭션이 **커밋**됩니다.
- **논리 트랜잭션 중 하나라도 롤백**: 외부 또는 내부 논리 트랜잭션 중 하나라도 **롤백**되면, 전체 물리 트랜잭션이 **롤백**됩니다.

---
