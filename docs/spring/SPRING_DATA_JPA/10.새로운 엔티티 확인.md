---
layout: default
title: μ›Ήμ—μ„ νμ΄μ§€μ™€μ •λ ¬
parent: SPRING DATA JPA
grand_parent: μ¤ν”„λ§
nav_order: 9
---

{: .no_toc }
 
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# π“ Persistableμ„ μ‚¬μ©ν•λ” μ΄μ 

JPAλ¥Ό μ‚¬μ©ν•λ‹¤ λ³΄λ©΄, μ—”ν‹°ν‹°κ°€ μƒλ΅μ΄ λ°μ΄ν„°μΈμ§€, μ΄λ―Έ μ΅΄μ¬ν•λ” λ°μ΄ν„°μΈμ§€λ¥Ό κµ¬λ¶„ν•  λ• λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤. μΌλ°μ μΌλ΅ JPAμ—μ„λ” **μ‹λ³„μ(id)** κ°€ **null**μΈ κ²½μ° μƒ μ—”ν‹°ν‹°λ΅ κ°„μ£Όν•κ³ , **persist** μ—°μ‚°μ„ μν–‰ν•©λ‹λ‹¤. ν•μ§€λ§, μ—”ν‹°ν‹°μ **μ‹λ³„μ(id)** κ°€ μλ™ μƒμ„±μ΄ μ•„λ‹ μλ™μΌλ΅ μ„¤μ •λλ” κ²½μ°, JPAκ°€ ν•΄λ‹Ή μ—”ν‹°ν‹°λ¥Ό **μƒλ΅μ΄ λ°μ΄ν„°**λ΅ μΈμ‹ν•μ§€ λ»ν•κ³ , **merge()** λ¥Ό μ‚¬μ©ν•μ—¬ μ²λ¦¬ν•κ² λ©λ‹λ‹¤. μ΄λ΅ μΈν•΄ λ¶ν•„μ”ν• **select ν›„ insert**κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ JPAμ—μ„λ” **`Persistable`** μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•©λ‹λ‹¤.

## 1. Persistableμ μ—­ν• 

**`Persistable`** μΈν„°νμ΄μ¤λ” μ—”ν‹°ν‹°κ°€ μƒλ΅μ΄ μ—”ν‹°ν‹°μΈμ§€ μ—¬λ¶€λ¥Ό νλ‹¨ν•λ” κΈ°μ¤€μ„ μ»¤μ¤ν„°λ§μ΄μ§•ν•  μ μκ² λ„μ™€μ¤λ‹λ‹¤. **μ‹λ³„μ(id)κ°€ nullμ΄ μ•„λ‹λ”λΌλ„, μƒλ΅μ΄ μ—”ν‹°ν‹°λ΅ μΈμ‹μ‹ν‚¤κ³  μ‹¶μ€ κ²½μ°** `Persistable` μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•μ—¬ μ—”ν‹°ν‹°μ μƒλ…μ£ΌκΈ°λ¥Ό μ μ–΄ν•  μ μμµλ‹λ‹¤.

### μ£Όμ” λ©”μ†λ“

- **`isNew()`**: μ΄ λ©”μ†λ“λ” ν•΄λ‹Ή μ—”ν‹°ν‹°κ°€ μƒλ΅μ΄ μ—”ν‹°ν‹°μΈμ§€ μ—¬λ¶€λ¥Ό κ²°μ •ν•©λ‹λ‹¤. λ³΄ν†µ, μ΄ λ©”μ†λ“κ°€ `true`λ¥Ό λ°ν™ν•λ©΄ JPAλ” μ—”ν‹°ν‹°λ¥Ό μƒλ΅ μ‚½μ…ν•κ³ , `false`λ¥Ό λ°ν™ν•λ©΄ μ—”ν‹°ν‹°λ¥Ό **merge**ν•μ—¬ μ—…λ°μ΄νΈν•λ ¤κ³  μ‹λ„ν•©λ‹λ‹¤.

## 2. Persistable μ‚¬μ© μμ‹

### λ¬Έμ  μƒν™©

μΌλ°μ μΌλ΅ JPAλ” μ—”ν‹°ν‹°μ **id**κ°€ **null**μΌ λ•λ§ μƒ μ—”ν‹°ν‹°λ΅ μΈμ‹ν•©λ‹λ‹¤. ν•μ§€λ§ **id**λ¥Ό μλ™μΌλ΅ ν• λ‹Ήν•λ” κ²½μ°, idκ°€ μ„¤μ •λμ–΄ μμ–΄λ„ JPAλ” μ΄λ¥Ό μƒ μ—”ν‹°ν‹°λ΅ μΈμ‹ν•μ§€ μ•κ³  **merge()** μ‘μ—…μ„ μ‹λ„ν•©λ‹λ‹¤. μ΄λ΅ μΈν•΄ **select** μΏΌλ¦¬κ°€ λ¨Όμ € μ‹¤ν–‰λκ³ , μ΄ν›„ **insert**κ°€ λ°μƒν•μ—¬ λ¶ν•„μ”ν• μ„±λ¥ μ €ν•κ°€ λ°μƒν•  μ μμµλ‹λ‹¤. μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ `Persistable`μ„ μ‚¬μ©ν•μ—¬ μλ™μΌλ΅ μ—”ν‹°ν‹°μ μƒνƒλ¥Ό μ μ–΄ν•©λ‹λ‹¤.

### μμ‹ μ½”λ“

```java
@Entity
public class User implements Persistable<String> {

    @Id
    private String id; // μλ™μΌλ΅ μ„¤μ •λλ” id

    private String username;

    @CreatedDate
    private LocalDateTime createdDate;

    @Override
    public boolean isNew() {
        // createdDateκ°€ nullμ΄λ©΄ μƒ μ—”ν‹°ν‹°λ΅ κ°„μ£Ό
        return this.createdDate == null;
    }
}
```

- **`isNew()`**: μ΄ λ©”μ†λ“λ” `createdDate`κ°€ **null**μΈ κ²½μ°, ν•΄λ‹Ή μ—”ν‹°ν‹°λ¥Ό μƒλ΅μ΄ μ—”ν‹°ν‹°λ΅ κ°„μ£Όν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ idκ°€ μ΄λ―Έ μ„¤μ •λμ–΄ μλ”λΌλ„, μƒ μ—”ν‹°ν‹°μ„μ„ λ…ν™•ν ν•  μ μμµλ‹λ‹¤.
- **μ‹λ³„μ ν• λ‹Ή**: idκ°€ μλ™μΌλ΅ μ„¤μ •λλ”λΌλ„, `isNew()` λ©”μ†λ“μ λ΅μ§μ— λ”°λΌ μƒ μ—”ν‹°ν‹°λ΅ μ²λ¦¬ν•  μ μμµλ‹λ‹¤.

### merge()λ΅ μΈν• λ¬Έμ  ν•΄κ²°

κΈ°λ³Έμ μΌλ΅ JPAλ” **μ‹λ³„μ(id)** κ°€ μμΌλ©΄ ν•΄λ‹Ή μ—”ν‹°ν‹°λ¥Ό κΈ°μ΅΄ λ°μ΄ν„°λ΅ κ°„μ£Όν•κ³  **merge()** λ©”μ†λ“λ¥Ό νΈμ¶ν•©λ‹λ‹¤. **merge()** λ” μ—”ν‹°ν‹°κ°€ λ°μ΄ν„°λ² μ΄μ¤μ— μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•κΈ° μ„ν•΄ **select** μΏΌλ¦¬λ¥Ό λ¨Όμ € μ‹¤ν–‰ν• ν›„, μ—†μΌλ©΄ **insert**λ¥Ό μν–‰ν•©λ‹λ‹¤. μ΄λ” λ¶ν•„μ”ν• μ„±λ¥ μ €ν•λ¥Ό μ λ°ν•  μ μμµλ‹λ‹¤.

**`Persistable`** μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ©΄, `isNew()` λ©”μ†λ“μ λ°ν™κ°’μ— λ”°λΌ JPAκ°€ `persist()`μ™€ `merge()`λ¥Ό λ…ν™•ν κµ¬λ¶„ν•μ—¬ μ²λ¦¬ν•  μ μμΌλ―€λ΅, **select ν›„ insert**κ°€ λ°μƒν•μ§€ μ•κ³  λ°”λ΅ **insert**κ°€ μ‹¤ν–‰λλ„λ΅ μ μ–΄ν•  μ μμµλ‹λ‹¤.
