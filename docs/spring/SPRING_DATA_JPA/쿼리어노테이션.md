---
layout: default
title: QUERY
parent: SPRING DATA JPA
grand_parent: μ¤ν”„λ§
nav_order: 2
---

{: .no_toc }
 
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# πΏ @Query μ–΄λ…Έν…μ΄μ…

`@Query` μ–΄λ…Έν…μ΄μ…μ€ Spring Data JPAμ—μ„ **μ»¤μ¤ν…€ μΏΌλ¦¬**λ¥Ό μ‘μ„±ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. κΈ°λ³Έμ μΈ μΏΌλ¦¬ λ©”μ†λ“λ΅ μ²λ¦¬ν•  μ μ—†λ” λ³µμ΅ν• μΏΌλ¦¬λ¥Ό μ‘μ„±ν•κ±°λ‚, μ„±λ¥ μµμ ν™”λ¥Ό μ„ν•΄ νΉμ • μΏΌλ¦¬λ¥Ό μ§μ ‘ μ‘μ„±ν•΄μ•Ό ν•  λ• μ μ©ν•©λ‹λ‹¤.

## π•κΈ°λ³Έ μ‚¬μ©λ²•

`@Query` μ–΄λ…Έν…μ΄μ…μ€ `Repository` μΈν„°νμ΄μ¤μ λ©”μ†λ“ μ„μ— μ‚¬μ©ν•λ©°, SQL λλ” JPQL μΏΌλ¦¬λ¥Ό μ§μ ‘ μ‘μ„±ν•  μ μμµλ‹λ‹¤.

### μμ‹

```java
@Query("SELECT u FROM User u WHERE u.username = :username")
User findByUsername(@Param("username") String username);
```

## π”DTOλ΅ μ΅°νν•κΈ°

μΏΌλ¦¬ κ²°κ³Όλ¥Ό μ—”ν‹°ν‹°κ°€ μ•„λ‹ **DTO**λ΅ μ§μ ‘ λ§¤ν•‘ν•  μ μμµλ‹λ‹¤. μ΄λ¥Ό μ„ν•΄μ„λ” **DTO ν΄λμ¤μ— μƒμ„±μ**κ°€ ν•„μ”ν•λ©°, `@Query`μ—μ„ SELECT μ μ— μ›ν•λ” ν•„λ“λ¥Ό μ§€μ •ν•κ³ , κ²°κ³Όλ¥Ό ν•΄λ‹Ή DTOλ΅ λ§¤ν•‘ν•©λ‹λ‹¤.

### DTO ν΄λμ¤ μ •μ

μ•„λλ” `UserDto`λΌλ” κ°„λ‹¨ν• DTO ν΄λμ¤μ μμ…λ‹λ‹¤.

```java
public class UserDto {

    private String username;
    private String email;
    ...
}
```

`UserDto`λ” `username`κ³Ό `email`μ„ ν•„λ“λ΅ κ°€μ§€λ©°, μƒμ„±μλ¥Ό ν†µν•΄ κ°’μ„ ν• λ‹Ήλ°›μµλ‹λ‹¤.

### @Queryλ΅ DTO μ΅°ν μμ‹

λ‹¤μμ€ `@Query` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ `UserDto`λ΅ κ²°κ³Όλ¥Ό μ΅°νν•λ” μμ μ…λ‹λ‹¤:

```java
@Query("SELECT new com.my.UserDto(u.username, u.email) FROM User u WHERE u.username = :username")
UserDto findUserDtoByUsername(@Param("username") String username);
```

- `com.my.UserDto`λ” DTO ν΄λμ¤μ **ν¨ν‚¤μ§€ κ²½λ΅**μ™€ **ν΄λμ¤ μ΄λ¦„**μ„ ν¬ν•¨ν•μ—¬ μ§€μ •ν•΄μ•Ό ν•©λ‹λ‹¤.

## π¥“νΉμ • ν•„λ“λ§ μ΅°νν•κΈ°

`@Query`λ¥Ό μ‚¬μ©ν•μ—¬ μ—”ν‹°ν‹°μ νΉμ • ν•„λ“λ§ μ΅°νν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, `username` ν•„λ“λ§ μ΅°νν•κ³  μ΄λ¥Ό `List<String>`μΌλ΅ λ°ν™ν•λ” μμ λ¥Ό λ§λ“¤μ–΄ λ³΄κ² μµλ‹λ‹¤.

### νΉμ • ν•„λ“ μ΅°ν μμ‹

```java
@Query("SELECT u.username FROM User u")
List<String> findUsernames();
```

## π°μ»¬λ ‰μ… νλΌλ―Έν„°μ™€ `IN` μ 

μ»¬λ ‰μ… νλΌλ―Έν„°λ” λ¦¬μ¤νΈ(List), μ…‹(Set) λ“±μ μλ°” μ»¬λ ‰μ…μ„ μ‚¬μ©ν•μ—¬ μ—¬λ¬ κ°’μ„ `IN` μ λ΅ μ „λ‹¬ν•λ” λ°©λ²•μ…λ‹λ‹¤. `IN` μ μ€ SQLμ—μ„ μ‚¬μ©λλ” κµ¬λ¬ΈμΌλ΅, νΉμ • μ»¬λΌμ κ°’μ΄ μ§€μ •λ μ—¬λ¬ κ°’ μ¤‘ ν•λ‚μ™€ μΌμΉν•λ” κ²½μ°λ¥Ό μ°Ύμ„ λ• μ‚¬μ©λ©λ‹λ‹¤.

### μμ‹

```java
@Query("SELECT u FROM User u WHERE u.username IN :usernames")
List<User> findByUsernames(@Param("usernames") List<String> usernames);
```