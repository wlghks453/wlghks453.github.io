---
layout: default
title: FETCH JOIN
parent: SPRING DATA JPA
grand_parent: ìŠ¤í”„ë§
nav_order: 5
---

## ëª©ì°¨
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# ğŸŒ¿ Fetch Joinê³¼ @EntityGraph

Spring Data JPAì—ì„œëŠ” ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ **Fetch Join**ê³¼ **`@EntityGraph`**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ë‘ ê°€ì§€ ë°©ë²•ì€ N+1 ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ì„±ëŠ¥ì„ ìµœì í™”í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤. 

## @EntityGraph ì–´ë…¸í…Œì´ì…˜

`@EntityGraph` ì–´ë…¸í…Œì´ì…˜ì€ JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ, íŠ¹ì • ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ íŒ¨ì¹˜(Fetch)í•˜ì—¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ëŠ” JPQLì˜ **Fetch Join**ê³¼ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ë§Œ, ì½”ë“œì˜ ê°€ë…ì„±ì„ ë†’ì´ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ í•´ì¤ë‹ˆë‹¤. `@EntityGraph`ëŠ” JPQL ì¿¼ë¦¬ ì—†ì´ë„, ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©(Eager Loading)í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### @EntityGraph ì‚¬ìš©ë²•

`@EntityGraph`ëŠ” ì£¼ë¡œ **Repository ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œ**ì— ì‚¬ìš©ë˜ë©°, `attributePaths` ì†ì„±ì„ í†µí•´ íŒ¨ì¹˜í•  ì—°ê´€ í•„ë“œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

### ì˜ˆì‹œ: @EntityGraphë¥¼ ì‚¬ìš©í•œ ì—°ê´€ ì—”í‹°í‹° ì¡°íšŒ

ì•„ë˜ëŠ” `User` ì—”í‹°í‹°ì™€ `Role` ì—”í‹°í‹°ê°€ `@ManyToOne` ë˜ëŠ” `@OneToMany` ê´€ê³„ë¡œ ì—°ê²°ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•œ ì˜ˆì œì…ë‹ˆë‹¤.

```java
@Entity
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String username;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private Role role; // Userì™€ Roleì€ ManyToOne ê´€ê³„
}
```

```java
@Entity
public class Role {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
}
```

### UserRepositoryì—ì„œ @EntityGraph ì‚¬ìš©í•˜ê¸°

ì•„ë˜ëŠ” `User`ì™€ `Role`ì„ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ë©”ì†Œë“œë¥¼ `@EntityGraph`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•œ ì˜ˆì œì…ë‹ˆë‹¤:

```java
public interface UserRepository extends JpaRepository<User, Long> {

    @EntityGraph(attributePaths = {"role"})
    List<User> findAll();
}
```

ìœ„ ì˜ˆì œì—ì„œ:

- `@EntityGraph(attributePaths = {"role"})`ëŠ” `User` ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ `role` ì—”í‹°í‹°ë¥¼ í•¨ê»˜ íŒ¨ì¹˜(fetch)í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
- `findAll` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´, `User` ì—”í‹°í‹°ì™€ ì—°ê´€ëœ `Role` ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ëŠ” N+1 ë¬¸ì œë¥¼ ë°©ì§€í•˜ê³  ì„±ëŠ¥ì„ ìµœì í™”í•©ë‹ˆë‹¤.

